function closeDisclaimer(){var e=new Date;e.setTime(e.getTime()+2592e6);var t="disclaimer="+(Date.now()/1e3|0)+";secure; path=/; expires="+e.toGMTString();document.cookie=t,greybox.close()}function addLiAlpha(e,t){var o=!1;$(e+" li").each(function(){if($(this).text().toLowerCase()>$(t).text().toLowerCase())return $(t).insertBefore($(this)),o=!0,!1}),o||$(t).appendTo($(e))}function homeGrid(e){var t=$("input[name=setHomeGrid]:checked").val(),e=ol.proj.transform(e,"EPSG:3857","EPSG:4326");switch(t){case"home":home.set(e);break;case"grid":grid.init(e),marker.get(!0);break;case"both":home.set(e),grid.init(e),marker.get(!0)}$("#resetSetHomeGrid").is(":checked")&&$("#setHomeGridNothing").prop("checked",!0)}var map,view,settings,ol,xs,xt,xl,ys,yt,yl,gridLayer,gridVector,geolocation,mapLayer,markerLayers=[],content,closer,overlay,days={0:"Su",1:"Mo",2:"Tu",3:"We",4:"Th",5:"Fr",6:"Sa"},controls={show:function(e){$("#controls").animate({left:"0px"},e),$("#controlsTop").animate({left:"0px",borderBottomRightRadius:0},e),$(".ol-scale-line").animate({left:"328px"},e),$(window).width()>400&&$(window).height()>400&&$("#w30warning").animate({left:"320px",paddingLeft:"0px"})},hide:function(){$("#controls").animate({left:"-320px"}),$("#controlsTop").animate({left:"-242px",borderBottomRightRadius:5}),$(".ol-scale-line").animate({left:"8px"}),$(window).width()>400&&$(window).height()>400&&$("#w30warning").animate({left:"0px",paddingLeft:"80px"})},toggle:function(){l=$("#controls").css("left"),"0px"===l?controls.hide():"-320px"===l&&controls.show()}},zoom={value:settings.user.zoom,change:function(){zoom.value=$("#inputZoomLevel").val(),$("#zoomControl .slider").slider("value",zoom.value),zoom.doZoom(zoom.value)},doZoom:function(e){view.animate({zoom:e,duration:500})},to:function(e,t,o){view.animate({zoom:o,center:ol.proj.transform([t,e],"EPSG:4326","EPSG:3857"),duration:500})},reset:function(){view.animate({zoom:settings.user.zoom,center:ol.proj.transform(settings.user.center,"EPSG:4326","EPSG:3857"),duration:500})}},home={layer:null,marker:null,point:null,set:function(e){for(map.removeLayer(home.layer);e[0]>180;)e[0]-=360;for(;e[0]<-180;)e[0]+=360;home.point=e,settings.user.home=e,home.marker=new ol.source.Vector({}),home.marker.addFeature(new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(e,"EPSG:4326","EPSG:3857"))})),home.layer=new ol.layer.Vector({source:home.marker,style:new ol.style.Style({image:new ol.style.Icon({anchor:[16,16],anchorXUnits:"pixels",anchorYUnits:"pixels",src:"/img/marker.png"})})}),map.addLayer(home.layer),2===view.getZoom()&&(zoom.to(e[1],e[0],settings.user.zoom),settings.user.center=ol.proj.transform(view.getCenter(),"EPSG:3857","EPSG:4326"))},distance:function(e){if(null==home.point)return"";var t=new ol.Sphere(6378137),o=t.haversineDistance(home.point,e)/1e3;return o.toFixed(2)+" km / "+(.621371*o).toFixed(2)+" miles<br/>"}};popover={lat:null,lng:null,coordinates:null,feature:null,geoName:function(){$.getJSON("//data.geohashing.info/geoName/"+this.lat+"/"+this.lng,function(e){$("#geoName").html(e.geoName)})},show:function(e){if(this.feature=e,this.coordinates=ol.proj.transform(e.getGeometry().getCoordinates(),"EPSG:3857","EPSG:4326"),this.lng=this.coordinates[0],this.lat=this.coordinates[1],this.geoName(),this.feature.get("global")){$("#popup").addClass("global");var t="Globalhash "+e.get("date"),o="global",n=this.feature.get("date")+"_global"}else{$("#popup").removeClass("global");var i=this.lng.toString().split(".")[0],r=this.lat.toString().split(".")[0],o=r+","+i,t="Geohash "+this.feature.get("date")+" "+r+" "+i,n=this.feature.get("date")+"_"+r+"_"+i}content.html("<strong>"+t+'</strong> <button onclick="window.open(&quot;http://wiki.xkcd.com/geohashing/'+n+'&quot;)">Meetup</button><br />'+this.lat.toFixed(8)+", "+this.lng.toFixed(8)+' <button onclick="zoom.to('+this.lat+","+this.lng+', 15)">Zoom in</button><br /><span id="geoName"><span style="color:silver;font-style:italic">[A location name should appear here]</span></span><br/>'+home.distance(this.coordinates)+'<button onclick="window.open(&quot;https://data.geohashing.info/hash/'+this.feature.get("date").split("-").join("/")+"/"+o+'.gpx&quot;)">GPX</button> <button onclick="window.open(&quot;http://geo.crox.net/poster/'+n+'&quot;)">Poster</button> <button onclick="window.open(&quot;http://www.geocaching.com/seek/nearest.aspx?origin_lat='+this.lat+"&amp;origin_long="+this.lng+'&quot;)">Nearby geocaches</button><button onclick="window.open(&quot;https://maps.google.com/?q='+this.lat+","+this.lng+'&quot;)">Google Maps</button> <button onclick="window.open(&quot;https://geohashing.info/mobile/'+this.feature.get("date").split("-").join("/")+"/"+o+'&quot;)">Navigation compass</button> '),overlay.setPosition(this.feature.getGeometry().getCoordinates())},hide:function(){overlay.setPosition(void 0)}},loadmap=function(){content=$("#popup-content"),closer=$("#popup-closer"),overlay=new ol.Overlay({element:document.getElementById("popup"),autoPan:!0,autoPanAnimation:{duration:250}}),closer.click(function(){return overlay.setPosition(void 0),closer.blur(),!1});var e="0,0"!=settings.user.center?settings.user.zoom:2;view=new ol.View({center:ol.proj.transform(settings.user.center,"EPSG:4326","EPSG:3857"),minZoom:settings.system.minZoom,zoom:e,maxZoom:settings.system.maxZoom,rotation:0,projection:"EPSG:3857"}),geolocation=new ol.Geolocation({projection:view.getProjection()}),"0,0"==settings.user.home&&geolocation.setTracking(!0),geolocation.on("change",function(){homeGrid(geolocation.getPosition())});var t={map:{source:new ol.source.OSM,name:"OpenStreetMap"},hyb:{source:new ol.source.BingMaps({key:settings.system.bingKey,imagerySet:"AerialWithLabels"}),name:"Bing maps (Hybrid)"},sat:{source:new ol.source.BingMaps({key:settings.system.bingKey,imagerySet:"Aerial"}),name:"Bing maps (Satellite)"}};mapLayer={list:{},current:settings.user.type,register:function(e,t,o){this.list[e]=t,addLiAlpha("#mapControl","<li onclick=\"javascript:mapLayer.load('"+e+'\')"><input type="radio" name="map" value="'+e+'" onchange="javascript:mapLayer.load(\''+e+'\')" id="map_'+e+'" '+(this.current===e?'checked="checked"':"")+'/> <label for="map_'+e+'">'+o+"</label></li>")},load:function(e){e!==this.current&&(this.list[e].setVisible(!0),this.list[this.current].setVisible(!1),this.current=e,$("#map_"+e).prop("checked",!0))}};var o=[];for(var n in t){var i=new ol.layer.Tile({source:t[n].source,visible:mapLayer.current===n});mapLayer.register(n,i,t[n].name),o.push(i)}var r=new ol.layer.Group({layers:o});navigator.userAgent.match(/Twitter for iP/i)?(renderer="dom",$(window).resize(function(){$("#map").width($(window).width()),$("#map").height($(window).height()),map.updateSize()})):renderer=["canvas","dom","webgl"],map=new ol.Map({target:document.getElementById("map"),layers:[r],view:view,controls:[new ol.control.ScaleLine,new ol.control.Attribution({collapsible:!1})],interactions:ol.interaction.defaults({rotate:!1,altShiftDragRotate:!1,pinchRotate:!1}),overlays:[overlay],renderer:renderer}),map.on("moveend",function(){$("#inputZoomLevel").val(view.getZoom()),zoom.change()}),map.on("singleclick",function(e){var t=map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});"undefined"!=typeof t&&t.get("date")?popover.show(t):homeGrid(e.coordinate)}),map.on("pointermove",function(e){var t=map.forEachFeatureAtPixel(e.pixel,function(e,t){return e.get("date")});map.getTargetElement().style.cursor=t?"pointer":""})};var greybox={isOpen:!1,open:function(e){return $.getJSON("/text/"+e,function(t){$("#greybox>div").attr("class",e),$("#greybox .title").html(t.title),$("#greybox .content").html(t.content),$("#greybox .content a[href^='http']").attr("target","_blank"),$("#greybox").fadeIn(),$("#greybox div").slideDown(),$("#greybox .content").scrollTop(0),greybox.isOpen=!0}),!1},close:function(){$("#greybox>div").slideUp(),$("#greybox").fadeOut(),$("#greybox .closer").blur(),greybox.isOpen=!1}},gcookie={set:function(){var e=new Date,t="";e.setFullYear(e.getFullYear()+10),settings.user.center=ol.proj.transform(view.getCenter(),"EPSG:3857","EPSG:4326"),settings.user.zoom=view.getZoom(),settings.user.single=!$("#showWeek").is(":checked"),settings.user.dayOf=$("#dayOfWeek").is(":checked")?"week":"month",settings.user.type=$("input[name=map]:checked").val(),settings.user.controlsVisible=$("#controlsVisible").is(":checked"),settings.user.resetSetHomeGrid=$("#resetSetHomeGrid").is(":checked"),t="config="+JSON.stringify(settings.user)+";secure; path=/; expires="+e.toGMTString(),document.cookie=t,greybox.open("settings")},unset:function(){cookie_string="config=;secure ;path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT",document.cookie=cookie_string,window.alert("Your cookie is deleted")}},w30warning={toggle:function(){if(lng=settings.user.grid[0],lng<-29||lng>=179){var e=new Date($("#dateControl .content.datepicker").datepicker("option","maxDate")),t=new Date($("#datepicker").val()),o=Math.abs(t.getTime()-e.getTime()),n=Math.ceil(o/864e5);0===n||n<7&&$("#showWeek").is(":checked")?this.show():this.hide()}else this.hide()},show:function(){$("#w30warning .date").html($("#dateControl .content.datepicker").datepicker("option","maxDate")),$("#w30warning").fadeIn()},hide:function(){$("#w30warning").fadeOut()},reset:function(){$(window).width()>400&&$(window).height()>400?(l=$("#controls").css("left"),"0px"===l?($("#w30warning").css("left","320px"),$("#w30warning").css("padding-left","0px")):"-320px"===l&&($("#w30warning").css("left","0px"),$("#w30warning").css("padding-left","80px"))):($("#w30warning").css("left",""),$("#w30warning").css("padding-left",""))}};