var map,view,settings,ol,xs,xt,xl,ys,yt,yl,gridLayer,gridVector,geolocation,mapLayer,content,closer,overlay,markerLayers=[],days={0:"Su",1:"Mo",2:"Tu",3:"We",4:"Th",5:"Fr",6:"Sa"};function roundCoords(e,t){return e[1].toFixed(t)+","+e[0].toFixed(t)}function updateUrl(){var e="//"+window.location.host+"/t:"+$("input[name=map]:checked").val()+"/"+$("#datepicker").val()+"/g:"+roundCoords(settings.user.grid,1)+"/c:"+roundCoords(ol.proj.transform(view.getCenter(),"EPSG:3857","EPSG:4326"),3)+"/z:"+Math.round(zoom.value);$("#showWeek").is(":checked")||(e+="/s"),$("#url").val(window.location.protocol+e),$("#updateBar").is(":checked")&&window.history.replaceState({},null,e)}function getUrl(){$("#url").select(),document.execCommand("copy")}function closeDisclaimer(){var e=new Date,e=(e.setTime(e.getTime()+2592e6),"disclaimer="+(Date.now()/1e3|0)+";secure; path=/; expires="+e.toGMTString());document.cookie=e,greybox.close()}function addLiAlpha(e,t){var o=!1;$(e+" li").each(function(){if($(this).text().toLowerCase()>$(t).text().toLowerCase())return $(t).insertBefore($(this)),!(o=!0)}),o||$(t).appendTo($(e))}var controls={show:function(e){$("#controls").animate({left:"0px"},e),$("#controlsTop").animate({left:"0px",borderBottomRightRadius:0},e),$(".ol-scale-line").animate({left:"328px"},e),400<$(window).width()&&400<$(window).height()&&$("#w30warning").animate({left:"320px",paddingLeft:"0px"})},hide:function(){$("#controls").animate({left:"-320px"}),$("#controlsTop").animate({left:"-242px",borderBottomRightRadius:5}),$(".ol-scale-line").animate({left:"8px"}),400<$(window).width()&&400<$(window).height()&&$("#w30warning").animate({left:"0px",paddingLeft:"80px"})},toggle:function(){"0px"===(l=$("#controls").css("left"))?controls.hide():"-320px"===l&&controls.show()}},zoom={value:settings.user.zoom,change:function(){zoom.value=$("#inputZoomLevel").val(),updateUrl(),$("#zoomControl .slider").slider("value",zoom.value),zoom.doZoom(zoom.value)},doZoom:function(e){view.animate({zoom:e,duration:500})},to:function(e,t,o){view.animate({zoom:o,center:ol.proj.transform([t,e],"EPSG:4326","EPSG:3857"),duration:500})},reset:function(){view.animate({zoom:settings.user.zoom,center:ol.proj.transform(settings.user.center,"EPSG:4326","EPSG:3857"),duration:500})}};function homeGrid(e){var t=$("input[name=setHomeGrid]:checked").val(),e=ol.proj.transform(e,"EPSG:3857","EPSG:4326");switch(t){case"home":home.set(e);break;case"grid":grid.init(e),marker.get(!0);break;case"both":home.set(e),grid.init(e),marker.get(!0)}$("#resetSetHomeGrid").is(":checked")&&$("#setHomeGridNothing").prop("checked",!0)}var home={layer:null,marker:null,point:null,set:function(e){for(map.removeLayer(home.layer);180<e[0];)e[0]-=360;for(;e[0]<-180;)e[0]+=360;home.point=e,settings.user.home=e,home.marker=new ol.source.Vector({}),home.marker.addFeature(new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(e,"EPSG:4326","EPSG:3857"))})),home.layer=new ol.layer.Vector({source:home.marker,style:new ol.style.Style({image:new ol.style.Icon({anchor:[16,16],anchorXUnits:"pixels",anchorYUnits:"pixels",src:"/img/marker.png"})})}),map.addLayer(home.layer),2===view.getZoom()&&(zoom.to(e[1],e[0],settings.user.zoom),settings.user.center=ol.proj.transform(view.getCenter(),"EPSG:3857","EPSG:4326")),updateUrl()},distance:function(e){return null==home.point?"":(e=new ol.Sphere(6378137).haversineDistance(home.point,e)/1e3).toFixed(2)+" km / "+(.621371*e).toFixed(2)+" miles<br/>"}},greybox=(popover={lat:null,lng:null,coordinates:null,feature:null,geoName:function(){$.getJSON("//data.geohashing.info/geoName/"+this.lat+"/"+this.lng,function(e){$("#geoName").html(e.geoName)})},show:function(e){var t,o,n;this.feature=e,this.coordinates=ol.proj.transform(e.getGeometry().getCoordinates(),"EPSG:3857","EPSG:4326"),this.lng=this.coordinates[0],this.lat=this.coordinates[1],this.geoName(),n=this.feature.get("global")?($("#popup").addClass("global"),o="Globalhash "+e.get("date"),t="global",this.feature.get("date")+"_global"):($("#popup").removeClass("global"),e=this.lng.toString().split(".")[0],t=(n=this.lat.toString().split(".")[0])+","+e,o="Geohash "+this.feature.get("date")+" "+n+" "+e,this.feature.get("date")+"_"+n+"_"+e),content.html("<strong>"+o+'</strong> <button onclick="window.open(&quot;https://geohashing.site/geohashing/'+n+'&quot;)">Meetup</button><br />'+this.lat.toFixed(5)+", "+this.lng.toFixed(5)+' <button onclick="zoom.to('+this.lat+","+this.lng+', 15)">Zoom in</button><br /><span id="geoName"><span style="color:silver;font-style:italic">[A location name should appear here]</span></span><br/>'+home.distance(this.coordinates)+'<button onclick="window.open(&quot;https://data.geohashing.info/hash/'+this.feature.get("date").split("-").join("/")+"/"+t+'.gpx&quot;)">GPX</button> <button onclick="window.open(&quot;http://geo.crox.net/poster/'+n+'&quot;)">Poster</button> <button onclick="window.open(&quot;http://www.geocaching.com/seek/nearest.aspx?origin_lat='+this.lat+"&amp;origin_long="+this.lng+'&quot;)">Nearby geocaches</button><button onclick="window.open(&quot;https://maps.google.com/?q='+this.lat+","+this.lng+'&quot;)">Google Maps</button> <button onclick="window.open(&quot;http://www.openstreetmap.org/index.html?mlat='+this.lat+"&mlon="+this.lng+'&quot;)">OSM</button>'),overlay.setPosition(this.feature.getGeometry().getCoordinates())},hide:function(){overlay.setPosition(void 0)}},{isOpen:!(loadmap=function(){content=$("#popup-content"),closer=$("#popup-closer"),overlay=new ol.Overlay({element:document.getElementById("popup"),autoPan:!0,autoPanAnimation:{duration:250}}),closer.click(function(){return overlay.setPosition(void 0),closer.blur(),!1});var e,t="0,0"!=settings.user.center?settings.user.zoom:2,o=(view=new ol.View({center:ol.proj.transform(settings.user.center,"EPSG:4326","EPSG:3857"),minZoom:settings.system.minZoom,zoom:t,maxZoom:settings.system.maxZoom,rotation:0,projection:"EPSG:3857"}),geolocation=new ol.Geolocation({projection:view.getProjection()}),"0,0"==settings.user.home&&(geolocation.setTracking(!0),("0,0"==settings.user.grid?$("#setHomeGridBoth"):$("#setHomeGridHome")).prop("checked",!0)),geolocation.on("change",function(){homeGrid(geolocation.getPosition())}),{map:{source:new ol.source.OSM,name:"OpenStreetMap"},hyb:{source:new ol.source.BingMaps({key:settings.system.bingKey,imagerySet:"AerialWithLabels"}),name:"Bing maps (Hybrid)"},sat:{source:new ol.source.BingMaps({key:settings.system.bingKey,imagerySet:"Aerial"}),name:"Bing maps (Satellite)"}}),n=(mapLayer={list:{},current:settings.user.type,register:function(e,t,o){this.list[e]=t,addLiAlpha("#mapControl","<li onclick=\"javascript:mapLayer.load('"+e+'\')"><input type="radio" name="map" value="'+e+'" onchange="javascript:mapLayer.load(\''+e+'\')" id="map_'+e+'" '+(this.current===e?'checked="checked"':"")+'/> <label for="map_'+e+'">'+o+"</label></li>")},load:function(e){e!==this.current&&(this.list[e].setVisible(!0),this.list[this.current].setVisible(!1),this.current=e,$("#map_"+e).prop("checked",!0),updateUrl())}},[]);for(e in o){var r=new ol.layer.Tile({source:o[e].source,visible:mapLayer.current===e});mapLayer.register(e,r,o[e].name),n.push(r)}t=new ol.layer.Group({layers:n});navigator.userAgent.match(/Twitter for iP/i)?(renderer="dom",$(window).resize(function(){$("#map").width($(window).width()),$("#map").height($(window).height()),map.updateSize()})):renderer=["canvas","dom","webgl"],(map=new ol.Map({target:document.getElementById("map"),layers:[t],view:view,controls:[new ol.control.ScaleLine,new ol.control.Attribution({collapsible:!1})],interactions:ol.interaction.defaults({rotate:!1,altShiftDragRotate:!1,pinchRotate:!1}),overlays:[overlay],renderer:renderer})).on("moveend",function(){$("#inputZoomLevel").val(view.getZoom()),zoom.change()}),map.on("singleclick",function(e){var t=map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});void 0!==t&&t.get("date")?popover.show(t):homeGrid(e.coordinate)}),map.on("pointermove",function(e){e=map.forEachFeatureAtPixel(e.pixel,function(e,t){return e.get("date")});map.getTargetElement().style.cursor=e?"pointer":""})}),open:function(t){return $.getJSON("/text/"+t,function(e){$("#greybox>div").attr("class",t),$("#greybox .title").html(e.title),$("#greybox .content").html(e.content),$("#greybox .content a[href^='http']").attr("target","_blank"),$("#greybox").fadeIn(),$("#greybox div").slideDown(),$("#greybox .content").scrollTop(0),greybox.isOpen=!0}),!1},close:function(){$("#greybox>div").slideUp(),$("#greybox").fadeOut(),$("#greybox .closer").blur(),greybox.isOpen=!1}}),gcookie={set:function(){var e=new Date;e.setFullYear(e.getFullYear()+10),settings.user.center=ol.proj.transform(view.getCenter(),"EPSG:3857","EPSG:4326"),settings.user.zoom=view.getZoom(),settings.user.single=!$("#showWeek").is(":checked"),settings.user.dayOf=$("#dayOfWeek").is(":checked")?"week":"month",settings.user.type=$("input[name=map]:checked").val(),settings.user.controlsVisible=$("#controlsVisible").is(":checked"),settings.user.setHomeGrid=$("input[name=setHomeGrid]:checked").val(),settings.user.resetSetHomeGrid=$("#resetSetHomeGrid").is(":checked"),e="config="+JSON.stringify(settings.user)+";secure; path=/; expires="+e.toGMTString(),document.cookie=e,greybox.open("settings")},unset:function(){cookie_string="config=;secure ;path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT",document.cookie=cookie_string,window.alert("Your cookie is deleted")}},w30warning={toggle:function(){var e,t;((lng=settings.user.grid[0])<-29||179<=lng)&&(t=new Date($("#dateControl .content.datepicker").datepicker("option","maxDate")),e=new Date($("#datepicker").val()),e=Math.abs(e.getTime()-t.getTime()),0===(t=Math.ceil(e/864e5))||t<7&&$("#showWeek").is(":checked"))?this.show():this.hide()},show:function(){$("#w30warning .date").html($("#dateControl .content.datepicker").datepicker("option","maxDate")),$("#w30warning").fadeIn()},hide:function(){$("#w30warning").fadeOut()},reset:function(){400<$(window).width()&&400<$(window).height()?"0px"===(l=$("#controls").css("left"))?($("#w30warning").css("left","320px"),$("#w30warning").css("padding-left","0px")):"-320px"===l&&($("#w30warning").css("left","0px"),$("#w30warning").css("padding-left","80px")):($("#w30warning").css("left",""),$("#w30warning").css("padding-left",""))}},grid={init:function(e){settings.user.grid=e,settings.user.center="0,0";for(var e=settings.user.center=e,t=Math.floor(Math.abs(e[1])),o=Math.floor(Math.abs(e[0])),n=0<=e[1]?1:-1,r=0<=e[0]?1:-1;180<o;)o-=360,settings.user.grid[0]-=360*r;if(0===t)ys=[0,0,1],yl=1==n?(yt=[-1,1,1],[[-1,2],[0,1]]):(yt=[1,-1,-1],[[-2,1],[-1,0]]);else if(89===t)ys=[88,89],yt=[n,n],yl=[[88*n,89.99*n],[89*n]];else{ys=[],yt=[];for(var a=t-1;a<=t+1;a++)ys.push(a),yt.push(n);yl=88===t?[[87*n,89.99*n],[88*n,89*n]]:[[n*(t-1),n*(t+2)],[n*t,n*(t+1)]]}if(0===o)xs=[0,0,1],xl=1==r?(xt=[-1,1,1],[[-1,2],[0,1]]):(xt=[1,-1,-1],[[-2,1],[-1,0]]);else if(179===o)xs=[178,179,179],xt=[r,1,-1],xl=[[178*r,181*r],[179*r,180*r]];else{xs=[],xt=[];for(var i=o-1;i<=o+1;i++)xs.push(i),xt.push(r);xl=[[r*(o-1),r*(o+2)],[r*o,r*(o+1)]]}this.draw()},draw:function(){map.removeLayer(gridLayer),gridVector=new ol.source.Vector({});for(var e=0;e<xl[1].length;e++)this.drawLine([[xl[1][e],yl[0][0]],[xl[1][e],yl[0][1]]]);for(var t=0;t<yl[1].length;t++)this.drawLine([[xl[0][0],yl[1][t]],[xl[0][1],yl[1][t]]]);gridLayer=new ol.layer.Vector({source:gridVector,style:new ol.style.Style({fill:new ol.style.Fill({color:"#0000FF",weight:4}),stroke:new ol.style.Stroke({color:"#0000FF",width:2})})}),map.addLayer(gridLayer)},drawLine:function(e){for(var t=0;t<e.length;t++)e[t]=ol.proj.transform(e[t],"EPSG:4326","EPSG:3857");gridVector.addFeature(new ol.Feature({geometry:new ol.geom.LineString(e)}))}},marker={curDate:null,date:null,get:function(e,t){if(updateUrl(),e=void 0!==e&&e,t=void 0!==t&&t,marker.date=$("#datepicker").val(),marker.date!==marker.curDate||e){for(var o=0;o<markerLayers.length;o++)map.removeLayer(markerLayers[o]);t||popover.hide(),markerLayers=[],marker.curDate=marker.date;e="//data.geohashing.info/hash/";$("#showWeek").is(":checked")&&(e+="wk/"),e+=marker.date.split("-").join("/")+".json",$.getJSON(e,function(e){marker.draw(e)}),w30warning.toggle()}},draw:function(e){if("[object Array]"===Object.prototype.toString.call(e))for(var t=0;t<e.length;t++)marker.doDraw(e[t]);else marker.doDraw(e)},doDraw:function(e){var t=new Date(e.date),t=(t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3),$("#dayOfWeek").is(":checked")?days[t.getDay()]:t.getDate()),o=$("#markerControl .colorPicker.selected").attr("bgcolor"),n=$("#markerControl .colorPicker.selected").attr("fgcolor");s=new ol.source.Vector({});for(var r=0;r<xs.length;r++)if(30<=xs[r]&-1===xt[r]&null!==e.west||xs[r]<30||1===xt[r])for(var a=0;a<ys.length;a++){var i=null,i=30<=xs[r]&-1===xt[r]?new ol.geom.Point(ol.proj.transform([parseFloat(xt[r]*(xs[r]+e.west.lng)),parseFloat(yt[a]*(ys[a]+e.west.lat))],"EPSG:4326","EPSG:3857")):new ol.geom.Point(ol.proj.transform([parseFloat(xt[r]*(xs[r]+e.east.lng)),parseFloat(yt[a]*(ys[a]+e.east.lat))],"EPSG:4326","EPSG:3857"));s.addFeature(new ol.Feature({geometry:i,date:e.date,global:!1}))}markerLayers.push(new ol.layer.Vector({source:s,style:new ol.style.Style({image:new ol.style.Icon({anchor:[13,36],anchorXUnits:"pixels",anchorYUnits:"pixels",src:"/img/marker.php?bg="+o+"&fg="+n+"&text="+t})})})),map.addLayer(markerLayers[markerLayers.length-1]),i=new ol.geom.Point(ol.proj.transform([parseFloat(e.global.lng),parseFloat(e.global.lat)],"EPSG:4326","EPSG:3857")),(s=new ol.source.Vector({})).addFeature(new ol.Feature({geometry:i,date:e.date,global:!0})),markerLayers.push(new ol.layer.Vector({source:s,style:new ol.style.Style({image:new ol.style.Icon({anchor:[25,72],anchorXUnits:"pixels",anchorYUnits:"pixels",src:"/img/marker.php?bg="+o+"&fg="+n+"&global&text="+t})})})),map.addLayer(markerLayers[markerLayers.length-1])}},date={value:null,change:function(){date.value=$("#datepicker").val(),$("#dateControl .content.datepicker").datepicker("setDate",date.value),marker.get()},refreshMaxDate:function(){$.getJSON("//data.geohashing.info/maxDate",function(e){$("#dateControl .content.datepicker").datepicker("option","maxDate")!==e.maxDate?($("#dateControl .content.datepicker").datepicker("option","maxDate",e.maxDate),marker.get(!0,!0),date.setTimer(10)):date.setTimer(e.nextCheck)})},setTimer:function(e){setTimeout(function(){date.refreshMaxDate()},1e3*e)}};$(window).load(function(){loadmap(),$("#showWeek").change(function(){marker.get(!0)}),$("#datepicker").change(function(){updateUrl(),date.change()}),$("#dateControl .content.datepicker").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showOtherMonths:!0,selectOtherMonths:!0,firstDay:1,minDate:settings.system.minDate,maxDate:settings.system.maxDate,altField:"#datepicker",defaultDate:settings.system.date,nextText:"&gt;",prevText:"&lt;",hideIfNoPrevNext:!0,onSelect:function(e){marker.get()}}),date.setTimer(settings.refreshMaxDate),$("#inputZoomLevel").change(function(){zoom.change()}),$("#inputZoomLevel").val(settings.user.zoom),$("#zoomControl .slider").slider({value:settings.user.zoom,min:settings.system.minZoom,max:settings.system.maxZoom,slide:function(e,t){$("#inputZoomLevel").val(t.value),zoom.doZoom(t.value)}}),640<$(window).width()&&settings.user.controlsVisible&&controls.show(0),"0,0"!=settings.user.home&&home.set(settings.user.home),"0,0"!=settings.user.grid&&(grid.init(settings.user.grid),marker.get()),$("input[name='dayOf']").change(function(){marker.get(!0,!0)}),$("#markerControl .colorPicker").click(function(e){$(e.target).hasClass("selected")||($("#markerControl .colorPicker").removeClass("selected"),$("#"+e.target.id).addClass("selected"),settings.user.colorSet=$("#"+e.target.id).attr("setid"),marker.get(!0,!0))}),$("#toggleControls").click(function(){controls.toggle()}),$("#openChangelog").click(function(){return greybox.open("changelog"),!1}),$("#openDisclaimer").click(function(){return greybox.open("disclaimer"),!1}),$("#openHelp").click(function(){return greybox.open("help"),!1}),$("#greybox").click(function(){greybox.close()}),$("#greybox>div").click(function(e){e.stopPropagation()}),$("#greybox .closer").click(function(){return greybox.close(),!1}),$(document).keyup(function(e){27===(c=e.keyCode||e.which)&&(greybox.isOpen?greybox.close():popover.hide())}),$("a[href^='http']").attr("target","_blank"),$("input[name=setHomeGrid]").change(function(){geolocation.setTracking(!1)}),$("#redetectHome").click(function(){"nothing"===$("input[name=setHomeGrid]:checked").val()?alert("Please first select what to detect"):geolocation.setTracking(!0)}),$("#controls").niceScroll(),settings.system.showDisclaimer&&greybox.open("disclaimer"),$("#w30warning .close").click(function(){w30warning.hide()}),$(window).on("resize",function(){w30warning.reset()})});
//# sourceMappingURL=map.min.js.map